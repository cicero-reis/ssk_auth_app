#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"
set -e

export PHP_CS_FIXER_IGNORE_ENV=1

echo "\nğŸ” Verificando PHP CSÂ Fixer (dryâ€‘run + diff + risky)â€¦"
./vendor/bin/php-cs-fixer fix \
    --dry-run --diff --allow-risky=yes

echo "\nğŸ”§ Corrigindo PHP CSÂ Fixer (apply + risky)â€¦"
./vendor/bin/php-cs-fixer fix \
    --allow-risky=yes \
    --using-cache=yes

echo "ğŸ“Œ Adicionando arquivos modificados ao commitâ€¦"
git add .

echo "\nğŸ” Rodando PHPStan (level max)â€¦"
./vendor/bin/phpstan analyse app --level=5

echo "âœ… Qualidade de cÃ³digo aprovada!\n"

echo "ğŸš€ Executando PHPUnitâ€¦"
php artisan test --stop-on-failure --colors=always

echo "\nâœ… Todos os testes passaram!\n"
